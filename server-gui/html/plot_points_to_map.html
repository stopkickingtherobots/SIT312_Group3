<!DOCTYPE html>
<html>
   <head>
      <title>Simple Map</title>
      <meta name="viewport" content="initial-scale=1.0">
      <meta charset="utf-8">
      <style>
         /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */      #map {
         height: 100%;
         }
         /* Optional: Makes the sample page fill the window. */      html, body {
         height: 100%;
         margin: 0;
         padding: 0;
         }
      </style>
      <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.23.0.js"></script>
   </head>
   <body>
      <div id="map"></div>
      <script>
         // the smooth zoom function
         function smoothZoom (map, max, cnt) {
          if (cnt >= max) {
           return;
          }
          else {
           z = google.maps.event.addListener(map, 'zoom_changed', function(event){
         	  google.maps.event.removeListener(z);
         	  smoothZoom(map, max, cnt + 1);
           });
           setTimeout(function(){map.setZoom(cnt)}, 80); // 80ms is what I found to work well on my system -- it might not work well on all systems
          }
         } 
         var pubnub = new PubNub({
         subscribeKey: "sub-c-5f7c7648-c99c-11e9-ac59-7e2323a85324",
         ssl: true
         });
         var longitude = -32.939350;
         var latitude = 151.666260;
         pubnub.addListener({
          message: function(m) {
           // handle message
           var channelName = m.channel; // The channel for which the message belongs
           var channelGroup = m.subscription; // The channel group or wildcard subscription match (if exists)
           var pubTT = m.timetoken; // Publish timetoken
           var msg = m.message; // The Payload
           longitude = msg.longitude;
           latitude = msg.latitude;
           var publisher = m.publisher; //The Publisher
         var myLatlng = new google.maps.LatLng(latitude, longitude);
         var marker = new google.maps.Marker({
         position: myLatlng,
         title:"Current Location"
         });
		 
		 var contentString = '<div id="content">'+
		  '<div id="siteNotice">'+
		  '</div>'+
		  '<h1 id="firstHeading" class="firstHeading">User Number: 0001</h1>'+
		  '<div id="bodyContent">'+
		  '<p>Location: Queens Wharf</p>'+
		  '<p>Time when at location: 9:31 AM</p>'+
		  '<p>Distance to base: 500m</p>'+
		  '</div>'+
		  '</div>';

		  var infowindow = new google.maps.InfoWindow({
			content: contentString
		  });

		  marker.addListener('click', function() {
			infowindow.open(map, marker);
		  });
	  
         // To add the marker to the map, call setMap();
         map.setCenter(marker.position);
         smoothZoom(map, 18, map.getZoom());
         marker.setMap(map);
          },
          presence: function(p) {
           // handle presence
           var action = p.action; // Can be join, leave, state-change or timeout
           var channelName = p.channel; // The channel for which the message belongs
           var occupancy = p.occupancy; // No. of users connected with the channel
           var state = p.state; // User State
           var channelGroup = p.subscription; //  The channel group or wildcard subscription match (if exists)
           var publishTime = p.timestamp; // Publish timetoken
           var timetoken = p.timetoken;  // Current timetoken
           var uuid = p.uuid; // UUIDs of users who are connected with the channel
          },
          status: function(s) {
           var affectedChannelGroups = s.affectedChannelGroups;
           var affectedChannels = s.affectedChannels;
           var category = s.category;
           var operation = s.operation;
          }
         });
         pubnub.subscribe({
          channels: ['blue'],
         });
          var map;
          function initMap() {
         map = new google.maps.Map(document.getElementById('map'), {
           center: {lat: latitude, lng: longitude},		  
           zoom: 18,
           styles: [{"featureType":"administrative","stylers":[{"visibility":"off"}]},{"featureType":"poi","stylers":[{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"simplified"}]},{"featureType":"water","stylers":[{"visibility":"simplified"}]},{"featureType":"transit","stylers":[{"visibility":"simplified"}]},{"featureType":"landscape","stylers":[{"visibility":"simplified"}]},{"featureType":"road.highway","stylers":[{"visibility":"off"}]},{"featureType":"road.local","stylers":[{"visibility":"on"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"water","stylers":[{"color":"#84afa3"},{"lightness":52}]},{"stylers":[{"saturation":-17},{"gamma":0.36}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"color":"#3f518c"}]}]
         
  }); }

      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCo2Op-g-ckDEE2G7BHaVgxLBGXfcDvPa8&callback=initMap"
         async defer></script>
   </body>
</html>

